VERSION="4.2.8p13"
SRCDIR="ntp-${VERSION}"
TARBALL="${SRCDIR}.tar.gz"
URL="https://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2"
SHA256SUM="288772cecfcd9a53694ffab108d1825a31ba77f3a8466b0401baeca3bc232a38"
DEPENDS="openssl-dev zlib-dev readline-dev toolchain"

prepare() {
	return
}

build() {
	CFLAGS=-fno-stack-protector \
	run_configure "$1" --with-openssl-libdir="$TCDIR/$TARGET/lib" \
		      --with-openssl-incdir="$TCDIR/$TARGET/include" \
		      --with-yielding-select=yes --enable-ipv6 \
		      --with-lineeditlibs=readline --without-rpath \
		      --without-sntp --with-ntpsnmpd

	CFLAGS=-fno-stack-protector \
	make -j $NUMJOBS
}

deploy() {
	make DESTDIR="$PKGDEPLOYDIR" install
	cp $SCRIPTDIR/pkg/$PKGNAME/*.{files,desc} "$PKGDEPLOYDIR"
}

check_update() {
	local version=$(echo $VERSION | sed 's/p/./g')

	curl --silent -L "http://support.ntp.org/rss/releases.xml" | \
	    grep -o "ntp-[0-9.p]*tar.gz" | \
	    sed 's/ntp-//g' | sed 's/.tar.gz//g' | sed 's/p/./g' | \
	    verson_find_greatest "$version"
}
