VERSION="0.2"
SRCDIR="init-${VERSION}"
TARBALL="${SRCDIR}.tar.xz"
URL="http://infraroot.at/pygos"
SHA256SUM="e5dda1b8997ce2dc622ce845b629978096b2b573c5c2d95a62c22a9ee29ee1a9"
DEPENDS="toolchain"

prepare() {
	return
}

build() {
	local SOURCE="$1"
	local DEPLOY="$2"

	$SOURCE/configure --prefix="" --host="$TARGET" --sbindir=/bin \
			  --libexecdir=/lib/libexec

	make -j $NUMJOBS
}

deploy() {
	local SOURCE="$1"
	local DEPLOY="$2"
	local svc

	make DESTDIR="$DEPLOY" install-strip

	mkdir -p "$DEPLOY/etc/init.d"

	if [ -e "$SCRIPTDIR/board/$BOARD/INIT" ]; then
		source "$SCRIPTDIR/board/$BOARD/INIT"
	fi
	if [ -e "$SCRIPTDIR/product/$PRODUCT/INIT" ]; then
		source "$SCRIPTDIR/product/$PRODUCT/INIT"
	fi

	if [ "x$HWCLOCK" == "xyes" ]; then
		ln -s "/share/init/hwclock" "$DEPLOY/etc/init.d/hwclock"
	fi

	for svc in $GETTY_TTY; do
		ln -s "/share/init/agetty" "$DEPLOY/etc/init.d/agetty@$svc"
	done

	unset -v i GETTY_TTY HWCLOCK
}
