VERSION="6.0"
SRCDIR="ncurses-${VERSION}"
TARBALL="${SRCDIR}.tar.gz"
URL="https://ftp.gnu.org/gnu/ncurses/"
SHA256SUM="f551c24b30ce8bfb6e96d9f59b42fbea30fa3a6123384172f9e7284bcf647260"

prepare() {
	return
}

build() {
	local INPUT="$1"
	local OUTPUT="$2"

	$INPUT/configure --prefix="" --host="$TARGET" \
			--with-shared --without-debug \
			--without-ada --enable-widec \
			--with-pkg-config-libdir=/lib/pkgconfig \
			--enable-pc-files

	make -j $NUMJOBS
}

deploy() {
	local SOURCE="$1"
	local BUILD="$2"
	local DEPLOY="$3"
	local DEVDEPLOY="$4"

	make DESTDIR="$DEPLOY" install

	rm -r "$DEPLOY/share/man"
	rm "$DEPLOY/bin/ncursesw6-config"

	mkdir -p "$DEVDEPLOY/lib"

	mv "$DEPLOY/include" "$DEVDEPLOY"
	cp -r "$DEPLOY/lib" "$DEVDEPLOY"
	rm ${DEPLOY}/lib/*.a
	rm -r "$DEPLOY/lib/pkgconfig"

	mkdir -p "${DEVDEPLOY}/include/ncurses"

	for hdr in ${DEVDEPLOY}/include/ncursesw/*.h; do
		local fname=$(basename $hdr)
		local target="../$fname"

		mv "$hdr" "${DEVDEPLOY}/include"
		ln -s "$target" "${DEVDEPLOY}/include/ncursesw/${fname}"
		ln -s "$target" "${DEVDEPLOY}/include/ncurses/${fname}"
	done

	ln -s "libncursesw.so.$VERSION" "$DEPLOY/lib/libtinfo.so"
	ln -s "libncursesw.so.$VERSION" "$DEPLOY/lib/libtinfo.so.$VERSION"
	ln -s "libncursesw.so.$VERSION" "$DEVDEPLOY/lib/libtinfo.so"
	ln -s "libncursesw.so.$VERSION" "$DEVDEPLOY/lib/libtinfo.so.$VERSION"
	ln -s "libncursesw.a.$VERSION" "$DEVDEPLOY/lib/libtinfo.a"
}
