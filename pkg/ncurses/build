VERSION="6.1"
SRCDIR="ncurses-${VERSION}"
TARBALL="${SRCDIR}.tar.gz"
URL="https://ftp.gnu.org/gnu/ncurses/"
SHA256SUM="aa057eeeb4a14d470101eff4597d5833dcef5965331be3528c08d99cebaa0d17"
DEPENDS="toolchain libstdc++-dev"
SUBPKG="ncurses-dev ncurses++-dev ncurses"

prepare() {
	return
}

build() {
	run_configure "$1" --with-shared --without-debug --without-ada \
		      --enable-widec --with-pkg-config-libdir=/lib/pkgconfig \
		      --enable-pc-files --disable-stripping

	make -j $NUMJOBS
}

deploy() {
	make DESTDIR="$PKGDEPLOYDIR" install
	cp $SCRIPTDIR/pkg/$PKGNAME/*.{files,desc} "$PKGDEPLOYDIR"
	rm "$PKGDEPLOYDIR/bin/ncursesw6-config"
	mkdir -p "$PKGDEPLOYDIR/include/ncurses"

	for hdr in ${PKGDEPLOYDIR}/include/ncursesw/*.h; do
		local fname=$(basename $hdr)
		local target="../$fname"

		mv "$hdr" "${PKGDEPLOYDIR}/include"
		ln -s "$target" "${PKGDEPLOYDIR}/include/ncursesw/${fname}"
		ln -s "$target" "${PKGDEPLOYDIR}/include/ncurses/${fname}"
	done

	ln -s "libncursesw.so.$VERSION" "$PKGDEPLOYDIR/lib/libtinfo.so"
	ln -s "libncursesw.so.$VERSION" "$PKGDEPLOYDIR/lib/libtinfo.so.$VERSION"
	ln -s "libncursesw.a" "$PKGDEPLOYDIR/lib/libtinfo.a"
}

check_update() {
	curl --silent -L "$URL" | grep -o ">ncurses-[0-9.]*tar.gz<" | \
	    sed 's/>ncurses-//g' | sed 's/.tar.gz<//g' | \
	    verson_find_greatest "$VERSION"
}
