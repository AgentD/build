DEPENDS="rootfs linux-rpi3 boot-rpi3"

build() {
	local SOURCE="$1"
	local BUILD="$2"
	local DEPLOY="$3"

	# copy output of immediate dependencies
	mkdir -p "$BUILD/boot"

	for pkgname in $DEPENDS; do
		if [ -e "$PKGDEPLOYDIR/$pkgname" ]; then
			cp -ru ${PKGDEPLOYDIR}/${pkgname}/* "$BUILD/boot"
		fi
	done

	# copy files from this package
	cp "$SCRIPTDIR/$PKGDIR/$PKGNAME/cmdline.txt" "$BUILD/boot"
	cp "$SCRIPTDIR/$PKGDIR/$PKGNAME/install.sh" "$BUILD"
	cp "$SCRIPTDIR/$PKGDIR/$PKGNAME/genimage.sh" "$BUILD"

	# substitute file names in scripts
	local rootfs_image="rootfs.img"

	sed -i 's/ROOTFSFILE/'$rootfs_image'/g' "$BUILD/boot/cmdline.txt"
}

deploy() {
	local SOURCE="$1"
	local BUILD="$2"
	local DEPLOY="$3"

	pushd "$PKGBUILDDIR" > /dev/null
	tar czf "$DEPLOY/$PKGNAME.tar.gz" "${PKGDIR}-${PKGNAME}"
	popd > /dev/null
}
